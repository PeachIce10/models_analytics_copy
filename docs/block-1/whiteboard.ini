Filled template — #1 Customer CLV Tiers (BG/NBD + Gamma–Gamma)

Goal
Predict each customer’s 6-month gross margin and assign VIP/High/Med/Low tiers.

1) Decision this powers
	•	Promo eligibility, loyalty budgeting, and VIP guardrails.

2) Known constants & units (write these first)
	•	W (calibration window) = 365 days
	•	H (forecast horizon) = 180 days
	•	Money unit = cents (keep everything in cents; convert to $ only at the end)
	•	No PV discount on 6–12m horizons (planning choice)
	•	Returns: use realized order margin (returns lower margin accordingly)

3) Inputs (from data)
From orders in the last W days (per customer):
	•	order_margin_cents for each order (amount − cogs − shipping − taxes − discounts ± returns)
From customers:
	•	first_purchase_ts, last_purchase_ts

Per-customer derived features (calibration period W):
	•	x = repeat purchase count in W (use repeat count consistent with your BG/NBD setup)
	•	T = age (days) from first purchase to end of W
	•	t_x = recency (days) from first to last purchase (≤ T)
	•	\bar m = average per-transaction margin in cents over the purchases used for monetary (requires x>0)

4) Symbols & hyperparameters (store-level)
BG/NBD (purchase incidence): r>0,\ \alpha>0,\ a>1,\ b>0
Gamma–Gamma (monetary, used only when x>0): p>0,\ q>1,\ \gamma>0

5) Expressions to write (in order)

A) Gamma–Gamma expected per-transaction margin (for x>0):
\mathbb{E}[M\mid x,\bar m] = \frac{(q+x)\,(\gamma + x\,\bar m)}{(q-1)\,(p+x)}\quad\text{(cents)}

B) BG/NBD expected transactions over horizon H:
\mathbb{E}[N(H)\mid x,t_x,T]=
\frac{a+b+x-1}{a-1}\cdot
\frac{1-\left(\frac{\alpha+T}{\alpha+T+H}\right)^{r+x}\,
{}2F_1\!\left(r{+}x,\ b{+}x;\ a{+}b{+}x{-}1;\ \frac{H}{\alpha+T+H}\right)}
{1+\mathbf{1}{\{x>0\}}\cdot\frac{a}{b+x-1}\left(\frac{\alpha+T}{\alpha+t_x}\right)^{r+x}}
	•	On a whiteboard, approximate the hypergeometric with a short series (K≈10 terms):
{}2F_1(A,B;C;z) \approx \sum{k=0}^{K} \frac{(A)_k (B)_k}{(C)_k}\frac{z^k}{k!}
where z=\tfrac{H}{\alpha+T+H} and (U)_k is the rising factorial.
(You can compute this later in Sheets; on the whiteboard you just note the series.)

C) CLV assembly
\mathrm{CLV}_H = \mathbb{E}[N(H)] \times \mathbb{E}[M]\quad\text{(cents)}

6) Step-by-step workflow (do this for one customer on the board)
	1.	From orders: compute x,\ T,\ t_x,\ \bar m.
	2.	Using your store hyperparameters r,\alpha,a,b,p,q,\gamma:
	•	Compute A) \mathbb{E}[M] (easy arithmetic).
	•	Compute B) \mathbb{E}[N(H)]: find z=H/(\alpha+T+H); if hand-calc, sum the first ~10 series terms; otherwise mark “2F1 via tool/Sheets.”
	3.	C) Multiply to get \mathrm{CLV}_H (keep in cents).
	4.	Repeat for a few customers to sanity-check ranges.
	5.	Tier cutoffs (P90/P70/P40, etc.)—note them at the bottom once you’ve run a sample.

7) Sanity checks (write these on the side)
	•	Constraints: a>1,\ q>1,\ t_x\le T,\ x\ge 0.
	•	Units: CLV must be cents; \mathbb{E}[M] > 0; \mathbb{E}[N(H)] \ge 0.
	•	Behavior: If x=0, \mathbb{E}[M] is undefined—use a conservative cohort monetary prior or skip GG for x=0 users.
	•	Limits: If H\to 0, \mathbb{E}[N(H)]\to 0; if T is large and t_x is recent, \mathbb{E}[N(H)] should be higher.

8) Output & how it’s used
	•	Emit CLV_180_cents and tier per customer.
	•	Policy: exclude VIP from deep blanket promos unless incremental tests justify.

⸻

Mini “glossary ledger” you can reuse on every model

Use this little table on the top-left of your board before you start any model:
	•	Window / Horizon: define W, H, units (days, weeks).
	•	Money unit: cents vs dollars; rounding rule (e.g., 2–4 dp internal, show 2 dp).
	•	Inputs: which tables and fields are allowed.
	•	Symbols: list the variables you’ll write in the formulas with a 4–6 word meaning.
	•	Hyperparameters: store-level knobs (not per user) and their constraints.
	•	Policy constants: risk weights, caps, penalties, half-life, etc.
	•	Outputs: exactly what this model emits (score, label, list) and where it is used.
	•	Checks: 2–3 constraints or bounds you’ll verify after the calc.

If you want, tell me the exact hyperparameters you’re using right now (r, α, a, b, p, q, γ) and one customer’s x,T,t_x,\bar m, and I’ll lay out the whiteboard computation for that row step-by-step.